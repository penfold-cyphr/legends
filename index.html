<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Mobile Upload UI</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#56b6f7; --muted:#9aa7b2; --glass: rgba(255,255,255,0.03);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071026 0%, #081427 100%);color:#e6f0f6}
    .wrap{max-width:480px;margin:28px auto;padding:20px}
    .card{background:var(--card);border-radius:18px;padding:18px;box-shadow:0 6px 28px rgba(2,6,23,0.6)}
    h1{font-size:18px;margin:0 0 8px}
    p.sub{color:var(--muted);margin:0 0 16px;font-size:13px}

    .options{display:grid;grid-template-columns:1fr;gap:12px}
    .btn{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:var(--glass);cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .btn:hover{transform:translateY(-2px)}
    .btn .icon{width:42px;height:42px;border-radius:9px;background:linear-gradient(135deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;font-weight:700}
    .btn .label{flex:1}
    .small{color:var(--muted);font-size:13px}
    .muted{color:var(--muted)}

    .preview{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
    .thumb{width:84px;height:84px;border-radius:10px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}

    .footer{margin-top:16px;display:flex;justify-content:space-between;align-items:center}
    .link{color:var(--accent);font-size:13px}

    /* mobile full screen feel */
    @media (max-width:420px){.wrap{margin:10px}}

    /* unobtrusive progress */
    .progress{height:6px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7dffea)}
  </style>
</head>
<body>
  <main class="wrap">
    <div class="card">
      <h1>Add photos</h1>
      <p class="sub">Choose a source to upload photos. This demo connects to your upload service endpoints ‚Äî change the URLs in the script to match your backend.</p>

      <div class="options">
        <!-- Device upload -->
        <label class="btn" id="deviceBtn" for="deviceInput" role="button">
          <div class="icon">üìÅ</div>
          <div class="label">
            <div>Upload from device</div>
            <div class="small muted">Select files from your phone or tablet</div>
          </div>
        </label>
        <input id="deviceInput" type="file" accept="image/*" multiple style="display:none">

        <!-- Instagram -->
        <div class="btn" id="instagramBtn" role="button">
          <div class="icon">üì∏</div>
          <div class="label">
            <div>Add from Instagram</div>
            <div class="small muted">Connect to Instagram to import photos</div>
          </div>
        </div>

        <!-- Facebook -->
        <div class="btn" id="facebookBtn" role="button">
          <div class="icon">üë•</div>
          <div class="label">
            <div>Add from Facebook</div>
            <div class="small muted">Connect to Facebook to import photos</div>
          </div>
        </div>
      </div>

      <div style="margin-top:14px">
        <div class="progress" aria-hidden>
          <i id="progressBar"></i>
        </div>
      </div>

      <div class="preview" id="preview"></div>

      <div class="footer">
        <div class="small muted">Tip: You can pick multiple images.</div>
        <a class="link" href="#" id="clearAll">Clear</a>
      </div>
    </div>

    <p style="text-align:center;color:var(--muted);font-size:12px;margin-top:10px">Demo: replace <code>/upload</code> and <code>/auth/*</code> endpoints with your upload service.</p>
  </main>

  <script>
    const ENDPOINTS = {
      uploadFile: '/upload',
      oauthStart: (provider) => `demo-oauth.html?provider=${provider}`,
      oauthTokenUpload: '/upload-from-provider'
    };

    const deviceInput = document.getElementById('deviceInput');
    const deviceBtn = document.getElementById('deviceBtn');
    const instagramBtn = document.getElementById('instagramBtn');
    const facebookBtn = document.getElementById('facebookBtn');
    const preview = document.getElementById('preview');
    const progress = document.getElementById('progressBar');
    const clearAll = document.getElementById('clearAll');

    deviceInput.addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files || []);
      if(!files.length) return;
      await uploadFiles(files);
    });

    deviceBtn.addEventListener('click', ()=> deviceInput.click());

    instagramBtn.addEventListener('click', ()=> startOAuth('instagram'));
    facebookBtn.addEventListener('click', ()=> startOAuth('facebook'));

    function startOAuth(provider){
      const w = 400, h = 300;
      const left = (screen.width/2) - (w/2);
      const top = (screen.height/2) - (h/2);
      const url = ENDPOINTS.oauthStart(provider);
      const popup = window.open(url, `${provider}-auth`, `width=${w},height=${h},left=${left},top=${top}`);
      if(!popup) window.location.href = url;
    }

    window.addEventListener('message', async (ev)=>{
      try{
        const msg = ev.data || {};
        if(msg && msg.type === 'oauth' && msg.provider && msg.accessToken){
          showToast(`Connected ${msg.provider}. Importing...`);
          await importFromProvider(msg.provider, msg.accessToken);
        }
      }catch(err){ console.error(err); }
    }, false);

    function setProgress(p){ progress.style.width = Math.max(0, Math.min(100, p)) + '%'; }

    async function uploadFiles(files){
      for(let file of files){
        addPreview(file);
        try{
          setProgress(10);
          const form = new FormData();
          form.append('file', file);
          const resp = await fetch(ENDPOINTS.uploadFile, {method:'POST', body: form});
          if(!resp.ok) throw new Error('Upload failed');
          setProgress(100);
          await new Promise(r=>setTimeout(r,300));
          setProgress(0);
        }catch(err){
          console.error('upload error', err);
          showToast('Upload failed for ' + file.name);
          setProgress(0);
        }
      }
    }

    function addPreview(fileOrUrl){
      const img = document.createElement('img');
      img.className = 'thumb';
      if(typeof fileOrUrl === 'string'){
        img.src = fileOrUrl;
      } else {
        img.src = URL.createObjectURL(fileOrUrl);
        img.onload = ()=> URL.revokeObjectURL(img.src);
      }
      preview.appendChild(img);
    }

    async function importFromProvider(provider, accessToken){
      try{
        setProgress(8);
        const resp = await fetch(ENDPOINTS.oauthTokenUpload, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({provider, accessToken})
        });
        if(!resp.ok) throw new Error('Import failed');
        const json = await resp.json();
        const items = json.imported || [];
        for(const it of items){ addPreview(it.url); }
        setProgress(100);
        await new Promise(r=>setTimeout(r,300));
        setProgress(0);
        showToast(`Imported ${items.length} from ${provider}`);
      }catch(err){
        console.error(err);
        showToast('Import failed');
        setProgress(0);
      }
    }

    clearAll.addEventListener('click', (e)=>{ e.preventDefault(); preview.innerHTML=''; });

    function showToast(msg){
      const t = document.createElement('div');
      t.textContent = msg; t.style.position='fixed'; t.style.left='50%'; t.style.transform='translateX(-50%)';
      t.style.bottom='28px'; t.style.background='rgba(14,20,28,0.9)'; t.style.padding='10px 14px'; t.style.borderRadius='10px';
      t.style.boxShadow='0 8px 30px rgba(3,6,12,0.6)'; t.style.color='#eaf6ff';
      document.body.appendChild(t);
      setTimeout(()=>{ t.style.transition='opacity 220ms'; t.style.opacity='0'; setTimeout(()=>t.remove(),240); }, 2500);
    }
  </script>

  <!-- Local Demo OAuth popup page -->
  <template id="demo-oauth-template">
    <!doctype html>
    <html>
      <body style="font-family:sans-serif;padding:20px">
        <h3>Demo OAuth Page</h3>
        <p>This simulates an OAuth provider.</p>
        <button onclick="sendToken()">Finish Auth</button>
        <script>
          function sendToken(){
            const params = new URLSearchParams(window.location.search);
            const provider = params.get('provider') || 'demo';
            window.opener.postMessage({
              type:'oauth',
              provider,
              accessToken:'DEMO_TOKEN_12345'
            }, window.origin);
            window.close();
          }
        </script>
      </body>
    </html>
  </template>
</body>
</html>
